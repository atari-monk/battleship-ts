(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();var m=(i=>(i[i.PLAYER1=0]="PLAYER1",i[i.PLAYER2=1]="PLAYER2",i))(m||{}),l=(i=>(i[i.LEFT=0]="LEFT",i[i.RIGHT=1]="RIGHT",i[i.UP=2]="UP",i[i.DOWN=3]="DOWN",i))(l||{}),y=(i=>(i[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",i))(y||{});function G(){const i=[0,1];return i[Math.floor(Math.random()*i.length)]}var d=(i=>(i[i.Unknown=0]="Unknown",i[i.Horizontal=1]="Horizontal",i[i.Vertical=2]="Vertical",i))(d||{});function b(i){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e=t.indexOf(i.minLetter.toUpperCase()),r=t.indexOf(i.maxLetter.toUpperCase()),s=t[Math.floor(Math.random()*(r-e+1))+e],n=Math.floor(Math.random()*(i.maxNumber-i.minNumber+1))+i.minNumber;return s+n}function f(i,t=10,e=10){const r=i.match(/^([A-J])(\d{1,2})$/i);if(!r)return null;const s=r[1].toUpperCase().charCodeAt(0)-65,n=parseInt(r[2],10)-1;return n>=0&&n<t&&s>=0&&s<e?{row:n,col:s}:null}function M(i,t,e=10,r=10){if(i<0||i>=e||t<0||t>=r)return null;const s=String.fromCharCode(t+65),n=i+1;return`${s}${n}`}function L(i,t){const e=Array.from(i);return e.sort((r,s)=>{const{row:n,col:o}=f(r),{row:a,col:c}=f(s);return t===d.Horizontal?o-c:n-a}),e}class z{constructor(t=10,e=10,r,s=[{id:1,size:5,type:"C"},{id:2,size:4,type:"B"},{id:3,size:3,type:"D"},{id:4,size:3,type:"S"},{id:5,size:2,type:"P"}]){this.rows=t,this.cols=e,this._grid=r??this.generateGrid(),this._ships=s}_grid;_ships;get grid(){return this._grid}get ships(){return this._ships}generateGrid(){const t=[];for(let e=0;e<this.rows;e++){const r=[];for(let s=0;s<this.cols;s++)r.push({isHit:!1});t.push(r)}return t}isValidPosition(t,e){return t>=0&&t<this.rows&&e>=0&&e<this.cols}getShipType(t){const e=this._ships.find(r=>r.id===t);return e?e.type:"?"}isGameOver(){for(let t of this._grid)for(let e of t)if(e.shipId!==void 0&&!e.isHit)return!1;return!0}hitCell(t){const e=f(t,this.rows,this.cols);if(!e||!this.isValidPosition(e.row,e.col))throw new Error("Invalid label provided");const{row:r,col:s}=e,n=this._grid[r][s];return n.isHit?{label:t,alreadyHit:!0,shipHit:!1}:(n.isHit=!0,{label:t,alreadyHit:!1,shipHit:!!n.shipId})}isMissNextTo(t,e){const r=f(t,this.rows,this.cols);if(!r||!this.isValidPosition(r.row,r.col))return!1;let{row:s,col:n}=r;switch(e){case l.LEFT:n--;break;case l.RIGHT:n++;break;case l.UP:s--;break;case l.DOWN:s++;break}if(!this.isValidPosition(s,n))return!1;const o=this._grid[s][n];return o.isHit&&!o.shipId}}class I{constructor(t){this.grid=t}render(t=!1){const e=this.grid.grid,r=e[0].length,s="   "+Array.from({length:r},(o,a)=>String.fromCharCode(65+a)).join(" "),n=e.map((o,a)=>{const c=(a+1).toString().padStart(2," "),h=o.map(u=>u.isHit?u.shipId?"X":"O":u.shipId?t?"-":this.getShipType(u.shipId):"-").join(" ");return`${c} ${h}`}).join(`
`);return`${s}
${n}`}getShipType(t){return this.grid.getShipType(t)}}class U{static placeShipsFromArray(t,e,r,s){if(t.length!==r||t[0].length!==s)return console.error("The grid must be 10x10."),!1;let n=1;for(let o=0;o<r;o++)for(let a=0;a<s;a++)t[o][a]===1&&e[o][a].shipId===void 0&&(e[o][a].shipId=n);return!0}}class ${placeFleet(t,e,r,s,n=!0){for(const o of t){let a=!1,c=0;for(;!a&&c<100;){const h=Math.random()<.5?"H":"V",u=h==="V"?r-o.size:r,F=h==="H"?s-o.size:s,T=Math.floor(Math.random()*u),A=Math.floor(Math.random()*F);this.canPlaceShip(T,A,h,o.size,e,r,s,n)&&(this.placeShip(T,A,h,o,e),a=!0),c++}if(!a)return console.error(`Failed to place ship of size ${o.size} after 100 attempts.`),!1}return!0}canPlaceShip(t,e,r,s,n,o,a,c){const h=[];if(r==="H"){if(e+s>a)return!1;for(let u=0;u<s;u++)h.push({row:t,col:e+u})}else{if(t+s>o)return!1;for(let u=0;u<s;u++)h.push({row:t+u,col:e})}return this.isValidPlacement(h,n,o,a,c)}isValidPlacement(t,e,r,s,n){for(const{row:o,col:a}of t)if(e[o][a].shipId!==void 0)return!1;if(n){for(const{row:o,col:a}of t)for(let c=o-1;c<=o+1;c++)for(let h=a-1;h<=a+1;h++)if(c>=0&&c<r&&h>=0&&h<s&&e[c][h].shipId!==void 0)return!1}return!0}placeShip(t,e,r,s,n){if(r==="H")for(let o=0;o<s.size;o++)n[t][e+o].shipId=s.id;else for(let o=0;o<s.size;o++)n[t+o][e].shipId=s.id}}class V{ships=new Set;handleShot(t){const e=this.findAdjacentShip(t);e?e.hits.add(t):this.ships.add({hits:new Set([t]),orientation:d.Unknown,isSunk:!1})}getFirstActiveHit(){for(const t of this.ships)if(t.orientation===d.Unknown&&!t.isSunk)return t}getShipToSink(){for(const t of this.ships)if(t.orientation!==d.Unknown&&!t.isSunk&&t.hits.size>=2)return t}findAdjacentShip(t){for(const e of this.ships)for(const r of e.hits)if(this.isAdjacent(r,t,e.orientation))return e}isAdjacent(t,e,r){const{row:s,col:n}=f(t),{row:o,col:a}=f(e);return r===d.Unknown?Math.abs(s-o)===1&&n===a||Math.abs(n-a)===1&&s===o:r===d.Horizontal?s===o&&Math.abs(n-a)===1:r===d.Vertical?n===a&&Math.abs(s-o)===1:!1}}var p=(i=>(i[i.Idle=0]="Idle",i[i.Random=1]="Random",i[i.ShipOrientation=2]="ShipOrientation",i[i.Sink=3]="Sink",i))(p||{});class C{_ai;constructor(t){this._ai=t}attack(t){let e=b(t);for(;this._ai.shotsTaken.has(e);)e=b(t);return this._ai.shotsTaken.add(e),{shot:e,log:r=>`Player 2: ${e} ${r?"hit":"miss"} AI: Random`}}updateState(){}}function k(){return Math.random()<.5}class O{_ai;orientation=y.Horizontal;counter=new Set;constructor(t){this._ai=t}attack(t){const e=this._ai.getHitShip(),r=f([...e.hits][0]),s=this.getNextMove(r),n=M(s.row,s.col);return this._ai.shotsTaken.add(n),{shot:n,log:o=>`Player 2: ${n} ${o?"hit":"miss"} AI: Ship Orientation orientation: ${d[e.orientation]}`}}updateState(){const t=this._ai.getHitShip();if(t.hits.size!==2)return;const[e,r]=[...t.hits],s=f(e),n=f(r);s.row===n.row?t.orientation=d.Horizontal:s.col===n.col&&(t.orientation=d.Vertical),this.reset()}getNextMove(t){this.orientation=G(),this.counter.has(l.LEFT)&&this.counter.has(l.RIGHT)&&(this.orientation=y.Vertical),this.counter.has(l.UP)&&this.counter.has(l.DOWN)&&(this.orientation=y.Horizontal);let e={row:t.row,col:t.col};return this.orientation===y.Horizontal?!this.counter.has(l.LEFT)&&k()?(this.counter.add(l.LEFT),e.row--):this.counter.has(l.RIGHT)||(this.counter.add(l.RIGHT),e.row++):!this.counter.has(l.DOWN)&&k()?(this.counter.add(l.DOWN),e.col--):this.counter.has(l.UP)||(this.counter.add(l.UP),e.col++),e}reset(){this.counter.clear()}}class B{_ai;constructor(t){this._ai=t}attack(t){const e=this._ai.getShipToSink();let r="",s=this.getRandomDirection(e.orientation),n=this.getLabelsFromSet(e.hits,s,e.orientation);this._ai.enemyGrid.isMissNextTo(n,s)&&(s=this.getOppositeDirection(s),n=this.getLabelsFromSet(e.hits,s,e.orientation));const a=f(n);let c={row:a.row,col:a.col};return e.orientation===d.Horizontal?(s===l.LEFT&&c.col--,s===l.RIGHT&&c.col++):(s===l.UP&&c.row--,s===l.DOWN&&c.row++),r=M(c.row,c.col),this.isShipSunk(e)&&(e.isSunk=!0),this._ai.shotsTaken.add(r),{shot:r,log:h=>`Player 2: ${r} ${h?"hit":"miss"} AI: Sink`}}updateState(){}test_getLabelsFromSet(t,e,r){return this.getLabelsFromSet(t,e,r)}getLabelsFromSet(t,e,r){if(t.size===0)return null;const s=L(t,r);return e===l.LEFT||e===l.UP?s[0]:s[s.length-1]}getRandomDirection(t){return t===d.Horizontal?k()?l.LEFT:l.RIGHT:k()?l.UP:l.DOWN}getOppositeDirection(t){switch(t){case l.LEFT:return l.RIGHT;case l.RIGHT:return l.LEFT;case l.UP:return l.DOWN;case l.DOWN:return l.UP}}isShipSunk(t){const e=L(t.hits,t.orientation);if(t.orientation===d.Horizontal){const r=e[0],s=e[e.length-1],n=this._ai.enemyGrid.isMissNextTo(r,l.LEFT),o=this._ai.enemyGrid.isMissNextTo(s,l.RIGHT);if(n&&o)return!0}else if(t.orientation===d.Vertical){const r=e[0],s=e[e.length-1],n=this._ai.enemyGrid.isMissNextTo(r,l.UP),o=this._ai.enemyGrid.isMissNextTo(s,l.DOWN);if(n&&o)return!0}return!1}}const R=Symbol("EVENT_STATE_CHANGED");class D{state;randomStrategy;shipOrientationStrategy;sinkStrategy;eventEmitter;constructor(t,e){this.state=p.Idle,this.randomStrategy=new C(t),this.shipOrientationStrategy=new O(t),this.sinkStrategy=new B(t),this.eventEmitter=e}setState(t){this.state!==t&&this.eventEmitter.emit(R,t),this.state=t}getStrategy(){switch(this.state){case p.ShipOrientation:return this.shipOrientationStrategy;case p.Sink:return this.sinkStrategy;case p.Random:default:return this.randomStrategy}}transition(t){t.isShipToSink()?this.setState(p.Sink):t.isShipHit()?this.setState(p.ShipOrientation):this.setState(p.Random)}}class W{enemyGrid;shotsTaken;stateMachine;shipTracker;constructor(t,e){this.enemyGrid=t,this.shipTracker=new V,this.shotsTaken=new Set,this.stateMachine=new D(this,e)}aiMove(t={minLetter:"A",maxLetter:"J",minNumber:1,maxNumber:10}){this.stateMachine.transition(this);const e=this.stateMachine.getStrategy(),{shot:r,log:s}=e.attack(t),n=this.enemyGrid.hitCell(r);return n.shipHit&&this.shipTracker.handleShot(r),e.updateState(),n.log=s,n}isShipHit(){return this.shipTracker.getFirstActiveHit()!==void 0}getHitShip(){return this.shipTracker.getFirstActiveHit()}isShipToSink(){return this.shipTracker.getShipToSink()!==void 0}getShipToSink(){return this.shipTracker.getShipToSink()}}var S=(i=>(i[i.STATIC=0]="STATIC",i[i.RANDOM=1]="RANDOM",i))(S||{}),H=(i=>(i[i.TWO_PLAYER=0]="TWO_PLAYER",i[i.PLAYER_VS_AI=1]="PLAYER_VS_AI",i[i.AI_TEST=2]="AI_TEST",i))(H||{}),w=(i=>(i[i.HUMAN=0]="HUMAN",i[i.AI=1]="AI",i))(w||{});const x={test4:{grid:[[0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,1,0],[0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0],[0,0,1,0,0,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0]],range:{minLetter:"A",maxLetter:"J",minNumber:1,maxNumber:10}}};class j{listeners=new Map;on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){const r=this.listeners.get(t);r&&(r.delete(e),r.size===0&&this.listeners.delete(t))}emit(t,e){const r=this.listeners.get(t);r&&r.forEach(s=>s(e))}clear(t){t?this.listeners.delete(t):this.listeners.clear()}once(t,e){const r=s=>{e(s),this.off(t,r)};this.on(t,r)}}function N(i){const t=new z,e=new $;switch(i){case S.RANDOM:e.placeFleet(t.ships,t.grid,t.rows,t.cols,!0);break;case S.STATIC:U.placeShipsFromArray(x.test4.grid,t.grid,t.rows,t.cols);break;default:e.placeFleet(t.ships,t.grid,t.rows,t.cols,!0);break}return t}const _=N(S.RANDOM),Y=N(S.RANDOM),g={mode:H.PLAYER_VS_AI,gridId:"grid",players:new Map([[m.PLAYER2,{role:m.PLAYER2,type:w.AI,name:"Player 2",style:v("red"),grid:Y,hideShips:!0}],[m.PLAYER1,{role:m.PLAYER1,type:w.HUMAN,name:"Player 1",style:v("lightblue"),grid:_,hideShips:!1}]])},E=new j;E.on(R,i=>{console.log("State changed to",p[i])});const J=new W(_,E);function X(i,t,e){const r=document.getElementById(i);r.textContent="",r.textContent=e.render(t.hideShips)}function K(i,t,e,r=!1){const{gridId:s}=t,n=t.players.get(i);if(X(s,n,e),!r)return;const{name:o,style:a,grid:c,hideShips:h}=n;console.log(`%c${o}`,a),console.log(`%c${e.render(h)}
`,a)}function P(i,t,e){K(i,t,e)}function v(i){return`color: ${i}; background-color: black; font-size: 20px; font-weight: bold;`}function q(i){return`color: ${i};`}async function Q(i){return new Promise(t=>{const e=document.getElementById("playerInput"),r=document.getElementById("submitInput"),s=document.getElementById("inputResult");e.style.display="block",r.style.display="block",s.style.display="none",e.focus();const n=()=>{const a=e.value.trim();a!==""&&(s.textContent=`${i}: ${a}`,s.style.display="block",e.style.display="none",r.style.display="none",t(a),e.value="",e.removeEventListener("keydown",o))},o=a=>{a.key==="Enter"&&(a.preventDefault(),n())};r.onclick=n,e.addEventListener("keydown",o)})}async function Z(i,t,e){return new Promise(r=>{const s=document.getElementById("inputResult");s.textContent=`${i}: ${t} ${e?"hit":"miss"}`,s.style.display="block",r()})}function tt(i){return new Promise(t=>{const e=document.getElementById(i);if(!e)throw new Error(`Button with ID "${i}" not found`);e.style.display="block";const r=()=>{e.style.display="none",e.removeEventListener("click",s),document.removeEventListener("keydown",n),t()},s=()=>r(),n=o=>{o.key==="Enter"&&(o.preventDefault(),setTimeout(r,100))};e.addEventListener("click",s),setTimeout(()=>document.addEventListener("keydown",n),200)})}function et(i,t){return[t,i]}async function it(i,t){const{name:e}=i,{grid:r}=t;let s=!1,n={label:"",alreadyHit:!1,shipHit:!1,log:o=>""};for(;!s;){let o="";g.mode===H.PLAYER_VS_AI&&i.type===w.HUMAN?(o=await Q(e),n=r.hitCell(o),console.log(`${e}:`,o,n.shipHit?"hit":"miss")):i.type===w.AI&&(n=J.aiMove(x.test4.range),console.log(n.log(n.shipHit)));const{alreadyHit:a}=n;a?console.log("%cThis cell was already hit. Try again.",q("yellow")):(s=!0,await Z(i.name,n.label,n.shipHit))}}async function st(){let i=!1,t=g.players.get(m.PLAYER1),e=g.players.get(m.PLAYER2);const r=new I(t.grid),s=new I(e.grid);for(;!i;){const n=t.role===m.PLAYER1?r:s;if(P(t.role,g,n),await it(e,t),i=t.grid.isGameOver(),P(t.role,g,n),i){console.log("Game over! All ships have been sunk.");break}await tt("continueButton"),g.mode===H.PLAYER_VS_AI&&([e,t]=et(e,t))}}await st();
//# sourceMappingURL=index-CQRMIBvN.js.map
