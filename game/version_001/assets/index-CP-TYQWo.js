(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();var g=(s=>(s[s.PLAYER1=0]="PLAYER1",s[s.PLAYER2=1]="PLAYER2",s))(g||{}),d=(s=>(s[s.Unknown=0]="Unknown",s[s.Horizontal=1]="Horizontal",s[s.Vertical=2]="Vertical",s))(d||{});function A(s){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ",e=t.indexOf(s.minLetter.toUpperCase()),r=t.indexOf(s.maxLetter.toUpperCase()),i=t[Math.floor(Math.random()*(r-e+1))+e],n=Math.floor(Math.random()*(s.maxNumber-s.minNumber+1))+s.minNumber;return i+n}function m(s,t=10,e=10){const r=s.match(/^([A-J])(\d{1,2})$/i);if(!r)return null;const i=r[1].toUpperCase().charCodeAt(0)-65,n=parseInt(r[2],10)-1;return n>=0&&n<t&&i>=0&&i<e?{row:n,col:i}:null}function _(s,t,e=10,r=10){if(s<0||s>=e||t<0||t>=r)return null;const i=String.fromCharCode(t+65),n=s+1;return`${i}${n}`}function L(s,t){const e=Array.from(s);return e.sort((r,i)=>{const{row:n,col:o}=m(r),{row:a,col:c}=m(i);return t===d.Horizontal?o-c:n-a}),e}var l=(s=>(s[s.LEFT=0]="LEFT",s[s.RIGHT=1]="RIGHT",s[s.UP=2]="UP",s[s.DOWN=3]="DOWN",s))(l||{});class O{constructor(t=10,e=10,r,i=[{id:1,size:5,type:"C"},{id:2,size:4,type:"B"},{id:3,size:3,type:"D"},{id:4,size:3,type:"S"},{id:5,size:2,type:"P"}]){this.rows=t,this.cols=e,this._grid=r??this.generateGrid(),this._ships=i}_grid;_ships;get grid(){return this._grid}get ships(){return this._ships}generateGrid(){const t=[];for(let e=0;e<this.rows;e++){const r=[];for(let i=0;i<this.cols;i++)r.push({isHit:!1});t.push(r)}return t}isValidPosition(t,e){return t>=0&&t<this.rows&&e>=0&&e<this.cols}getShipType(t){const e=this._ships.find(r=>r.id===t);return e?e.type:"?"}isGameOver(){for(let t of this._grid)for(let e of t)if(e.shipId!==void 0&&!e.isHit)return!1;return!0}hitCell(t){const e=m(t,this.rows,this.cols);if(!e||!this.isValidPosition(e.row,e.col))throw new Error("Invalid label provided");const{row:r,col:i}=e,n=this._grid[r][i];return n.isHit?{label:t,alreadyHit:!0,shipHit:!1}:(n.isHit=!0,{label:t,alreadyHit:!1,shipHit:!!n.shipId})}isMissNextTo(t,e){const r=m(t,this.rows,this.cols);if(!r||!this.isValidPosition(r.row,r.col))return!1;let{row:i,col:n}=r;switch(e){case l.LEFT:n--;break;case l.RIGHT:n++;break;case l.UP:i--;break;case l.DOWN:i++;break}if(!this.isValidPosition(i,n))return!1;const o=this._grid[i][n];return o.isHit&&!o.shipId}}class H{constructor(t){this.grid=t}render(t=!1){const e=this.grid.grid,r=e[0].length,i="   "+Array.from({length:r},(o,a)=>String.fromCharCode(65+a)).join(" "),n=e.map((o,a)=>{const c=(a+1).toString().padStart(2," "),h=o.map(u=>u.isHit?u.shipId?"X":"O":u.shipId?t?"-":this.getShipType(u.shipId):"-").join(" ");return`${c} ${h}`}).join(`
`);return`${i}
${n}`}getShipType(t){return this.grid.getShipType(t)}}class U{static placeShipsFromArray(t,e,r,i){if(t.length!==r||t[0].length!==i)return console.error("The grid must be 10x10."),!1;let n=1;for(let o=0;o<r;o++)for(let a=0;a<i;a++)t[o][a]===1&&e[o][a].shipId===void 0&&(e[o][a].shipId=n);return!0}}class V{placeFleet(t,e,r,i,n=!0){for(const o of t){let a=!1,c=0;for(;!a&&c<100;){const h=Math.random()<.5?"H":"V",u=h==="V"?r-o.size:r,C=h==="H"?i-o.size:i,k=Math.floor(Math.random()*u),I=Math.floor(Math.random()*C);this.canPlaceShip(k,I,h,o.size,e,r,i,n)&&(this.placeShip(k,I,h,o,e),a=!0),c++}if(!a)return console.error(`Failed to place ship of size ${o.size} after 100 attempts.`),!1}return!0}canPlaceShip(t,e,r,i,n,o,a,c){const h=[];if(r==="H"){if(e+i>a)return!1;for(let u=0;u<i;u++)h.push({row:t,col:e+u})}else{if(t+i>o)return!1;for(let u=0;u<i;u++)h.push({row:t+u,col:e})}return this.isValidPlacement(h,n,o,a,c)}isValidPlacement(t,e,r,i,n){for(const{row:o,col:a}of t)if(e[o][a].shipId!==void 0)return!1;if(n){for(const{row:o,col:a}of t)for(let c=o-1;c<=o+1;c++)for(let h=a-1;h<=a+1;h++)if(c>=0&&c<r&&h>=0&&h<i&&e[c][h].shipId!==void 0)return!1}return!0}placeShip(t,e,r,i,n){if(r==="H")for(let o=0;o<i.size;o++)n[t][e+o].shipId=i.id;else for(let o=0;o<i.size;o++)n[t+o][e].shipId=i.id}}class z{ships=new Set;handleShot(t){const e=this.findAdjacentShip(t);e?e.hits.add(t):this.ships.add({hits:new Set([t]),orientation:d.Unknown,isSunk:!1})}getFirstActiveHit(){for(const t of this.ships)if(t.orientation===d.Unknown&&!t.isSunk)return t}getShipToSink(){for(const t of this.ships)if(t.orientation!==d.Unknown&&!t.isSunk&&t.hits.size>=2)return t}findAdjacentShip(t){for(const e of this.ships)for(const r of e.hits)if(this.isAdjacent(r,t,e.orientation))return e}isAdjacent(t,e,r){const{row:i,col:n}=m(t),{row:o,col:a}=m(e);return r===d.Unknown?Math.abs(i-o)===1&&n===a||Math.abs(n-a)===1&&i===o:r===d.Horizontal?i===o&&Math.abs(n-a)===1:r===d.Vertical?n===a&&Math.abs(i-o)===1:!1}}var f=(s=>(s[s.Idle=0]="Idle",s[s.Random=1]="Random",s[s.ShipOrientation=2]="ShipOrientation",s[s.Sink=3]="Sink",s))(f||{});class D{_ai;constructor(t){this._ai=t}attack(t){let e=A(t);for(;this._ai.shotsTaken.has(e);)e=A(t);return this._ai.shotsTaken.add(e),{shot:e,log:r=>`Player 2: ${e} ${r?"hit":"miss"} AI: Random`}}updateState(){}}class B{_ai;MOVE_MAP;directions;directionIndex;directionChecks;constructor(t){this._ai=t,this.MOVE_MAP=this.getMoveMap(),this.directions=[l.LEFT,l.UP,l.RIGHT,l.DOWN],this.directionIndex=0,this.directionChecks=[e=>this.directions[this.directionIndex]===l.LEFT&&e.col===0,e=>this.directions[this.directionIndex]===l.UP&&e.row===0,e=>this.directions[this.directionIndex]===l.RIGHT&&e.col===9,e=>this.directions[this.directionIndex]===l.DOWN&&e.row===9]}getMoveMap(){return{[l.LEFT]:{row:0,col:-1},[l.UP]:{row:-1,col:0},[l.RIGHT]:{row:0,col:1},[l.DOWN]:{row:1,col:0}}}attack(t){const e=this._ai.getHitShip(),r=m([...e.hits][0]),i=this.getNextMove(r),n=_(i.row,i.col);return this._ai.shotsTaken.add(n),{shot:n,log:o=>`Player 2: ${n} ${o?"hit":"miss"} AI: Ship Orientation orientation: ${d[e.orientation]}`}}updateState(){const t=this._ai.getHitShip();if(t.hits.size!==2)return;const[e,r]=[...t.hits],i=m(e),n=m(r);i.row===n.row?t.orientation=d.Horizontal:i.col===n.col&&(t.orientation=d.Vertical),this.reset()}getNextMove(t){let e={row:t.row,col:t.col},r=!1;for(;!r;)this.directionChecks[this.directionIndex](t)?this.directionIndex=(this.directionIndex+1)%this.directions.length:r=!0;const i=this.MOVE_MAP[this.directions[this.directionIndex]];return e.row+=i.row,e.col+=i.col,this.directionIndex=(this.directionIndex+1)%this.directions.length,e}reset(){this.directionIndex=0}}function x(){return Math.random()<.5}class W{_ai;constructor(t){this._ai=t}attack(t){const e=this._ai.getShipToSink();let r="",i=this.getRandomDirection(e.orientation),n=this.getLabelsFromSet(e.hits,i,e.orientation);this._ai.enemyGrid.isMissNextTo(n,i)&&(i=this.getOppositeDirection(i),n=this.getLabelsFromSet(e.hits,i,e.orientation));const a=m(n);let c={row:a.row,col:a.col};return e.orientation===d.Horizontal?(i===l.LEFT&&c.col--,i===l.RIGHT&&c.col++):(i===l.UP&&c.row--,i===l.DOWN&&c.row++),r=_(c.row,c.col),this.isShipSunk(e)&&(e.isSunk=!0),this._ai.shotsTaken.add(r),{shot:r,log:h=>`Player 2: ${r} ${h?"hit":"miss"} AI: Sink`}}updateState(){}test_getLabelsFromSet(t,e,r){return this.getLabelsFromSet(t,e,r)}getLabelsFromSet(t,e,r){if(t.size===0)return null;const i=L(t,r);return e===l.LEFT||e===l.UP?i[0]:i[i.length-1]}getRandomDirection(t){return t===d.Horizontal?x()?l.LEFT:l.RIGHT:x()?l.UP:l.DOWN}getOppositeDirection(t){switch(t){case l.LEFT:return l.RIGHT;case l.RIGHT:return l.LEFT;case l.UP:return l.DOWN;case l.DOWN:return l.UP}}isShipSunk(t){const e=L(t.hits,t.orientation);if(t.orientation===d.Horizontal){const r=e[0],i=e[e.length-1],n=this._ai.enemyGrid.isMissNextTo(r,l.LEFT),o=this._ai.enemyGrid.isMissNextTo(i,l.RIGHT);if(n&&o)return!0}else if(t.orientation===d.Vertical){const r=e[0],i=e[e.length-1],n=this._ai.enemyGrid.isMissNextTo(r,l.UP),o=this._ai.enemyGrid.isMissNextTo(i,l.DOWN);if(n&&o)return!0}return!1}}const N=Symbol("EVENT_STATE_CHANGED");class j{state;randomStrategy;shipOrientationStrategy;sinkStrategy;eventEmitter;constructor(t,e){this.state=f.Idle,this.randomStrategy=new D(t),this.shipOrientationStrategy=new B(t),this.sinkStrategy=new W(t),this.eventEmitter=e}setState(t){this.state!==t&&this.eventEmitter.emit(N,t),this.state=t}getStrategy(){switch(this.state){case f.ShipOrientation:return this.shipOrientationStrategy;case f.Sink:return this.sinkStrategy;case f.Random:default:return this.randomStrategy}}transition(t){t.isShipToSink()?this.setState(f.Sink):t.isShipHit()?this.setState(f.ShipOrientation):this.setState(f.Random)}}class J{enemyGrid;shotsTaken;stateMachine;shipTracker;constructor(t,e){this.enemyGrid=t,this.shipTracker=new z,this.shotsTaken=new Set,this.stateMachine=new j(this,e)}aiMove(t={minLetter:"A",maxLetter:"J",minNumber:1,maxNumber:10}){this.stateMachine.transition(this);const e=this.stateMachine.getStrategy(),{shot:r,log:i}=e.attack(t),n=this.enemyGrid.hitCell(r);return n.shipHit&&this.shipTracker.handleShot(r),e.updateState(),n.log=i,n}isShipHit(){return this.shipTracker.getFirstActiveHit()!==void 0}getHitShip(){return this.shipTracker.getFirstActiveHit()}isShipToSink(){return this.shipTracker.getShipToSink()!==void 0}getShipToSink(){return this.shipTracker.getShipToSink()}}var y=(s=>(s[s.STATIC=0]="STATIC",s[s.RANDOM=1]="RANDOM",s))(y||{}),S=(s=>(s[s.AI_TEST=0]="AI_TEST",s[s.PLAYER_VS_AI=1]="PLAYER_VS_AI",s))(S||{}),T=(s=>(s[s.HUMAN=0]="HUMAN",s[s.AI=1]="AI",s))(T||{});class b{static edgeMap={[l.LEFT]:{l:1,r:0,u:0,d:0,nr:1,letter:"A",number:1},[l.RIGHT]:{l:0,r:1,u:0,d:0,nr:2,letter:"J",number:1},[l.UP]:{l:0,r:0,u:1,d:0,nr:3,letter:"J",number:10},[l.DOWN]:{l:0,r:0,u:0,d:1,nr:4,letter:"A",number:10}};edge;l;r;u;d;nr;letter;number;constructor(t){this.edge=t;const{l:e,r,u:i,d:n,nr:o,letter:a,number:c}=b.edgeMap[t];this.l=e,this.r=r,this.u=i,this.d=n,this.nr=o,this.letter=a,this.number=c}generateGrid(){const t=this.u,e=this.l,r=this.r,i=this.d;return[[e,0,0,0,0,0,0,0,0,t],[e,0,0,0,0,0,0,0,0,t],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[i,0,0,0,0,0,0,0,0,r],[i,0,0,0,0,0,0,0,0,r]]}getTest(){return{key:`test5_${this.nr}`,description:`Test 5_${this.nr}: 2 cells on the ${l[this.edge]} corner of the grid`,grid:this.generateGrid(),range:{minLetter:this.letter,maxLetter:this.letter,minNumber:this.number,maxNumber:this.number}}}}class w{static edgeMap={[l.LEFT]:{l:1,r:0,u:0,d:0,nr:1,letter:"A",number:5},[l.RIGHT]:{l:0,r:1,u:0,d:0,nr:2,letter:"J",number:5},[l.UP]:{l:0,r:0,u:1,d:0,nr:3,letter:"E",number:1},[l.DOWN]:{l:0,r:0,u:0,d:1,nr:4,letter:"E",number:10}};edge;l;r;u;d;nr;letter;number;constructor(t){this.edge=t;const{l:e,r,u:i,d:n,nr:o,letter:a,number:c}=w.edgeMap[t];this.l=e,this.r=r,this.u=i,this.d=n,this.nr=o,this.letter=a,this.number=c}generateGrid(){const t=this.u,e=this.l,r=this.r,i=this.d;return[[0,0,0,0,t,0,0,0,0,0],[0,0,0,0,t,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[e,e,0,0,0,0,0,0,r,r],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,i,0,0,0,0,0],[0,0,0,0,i,0,0,0,0,0]]}getTest(){return{key:`test4_${this.nr}`,description:`Test 4_${this.nr}: 2 cells on the ${l[this.edge]} edge of the grid`,grid:this.generateGrid(),range:{minLetter:this.letter,maxLetter:this.letter,minNumber:this.number,maxNumber:this.number}}}}const v={},Y={key:"test1",description:"Test 1: 4 cells in a row",grid:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,1,1,1,1,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],range:{minLetter:"C",maxLetter:"H",minNumber:5,maxNumber:5}},X={key:"test2",description:"Test 2: 4 cells in a column",grid:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,1,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],range:{minLetter:"F",maxLetter:"F",minNumber:3,maxNumber:8}},K={key:"test3",description:"Test 3: 2 x 4 cells in a row and a column",grid:[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1,0,0],[0,0,1,1,1,1,0,1,0,0],[0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,1,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0]],range:{minLetter:"C",maxLetter:"H",minNumber:4,maxNumber:7}},q=new w(l.LEFT).getTest(),Q=new w(l.RIGHT).getTest(),Z=new w(l.UP).getTest(),tt=new w(l.DOWN).getTest(),et=new b(l.LEFT).getTest(),it={key:"test6",description:"Test 6: Fleet of 5 ships",grid:[[0,0,0,0,0,0,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,1,0,0,0,0],[0,1,0,0,0,0,0,0,0,0],[0,1,0,0,0,0,1,1,1,0],[0,0,0,0,0,0,0,0,0,0],[0,0,1,0,0,0,0,0,0,0],[0,0,1,0,0,1,1,1,1,0],[0,0,0,0,0,0,0,0,0,0]],range:{minLetter:"A",maxLetter:"J",minNumber:1,maxNumber:10}},st=[Y,X,K,q,Q,Z,tt,et,it];st.forEach(s=>{v[s.key]=s});const E=v.test4_1;class rt{listeners=new Map;on(t,e){this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e)}off(t,e){const r=this.listeners.get(t);r&&(r.delete(e),r.size===0&&this.listeners.delete(t))}emit(t,e){const r=this.listeners.get(t);r&&r.forEach(i=>i(e))}clear(t){t?this.listeners.delete(t):this.listeners.clear()}once(t,e){const r=i=>{e(i),this.off(t,r)};this.on(t,r)}}function G(s){const t=new O,e=new V;switch(s){case y.RANDOM:e.placeFleet(t.ships,t.grid,t.rows,t.cols,!0);break;case y.STATIC:U.placeShipsFromArray(E.grid,t.grid,t.rows,t.cols);break;default:e.placeFleet(t.ships,t.grid,t.rows,t.cols,!0);break}return t}const R=S.PLAYER_VS_AI,F=G(R===S.AI_TEST?y.STATIC:y.RANDOM),nt=G(y.RANDOM),p={printGridInConsole:!1,mode:R,gridId:"grid",players:new Map([[g.PLAYER2,{role:g.PLAYER2,type:T.AI,name:"Player 2",style:P("red"),grid:nt,hideShips:!0}],[g.PLAYER1,{role:g.PLAYER1,type:T.HUMAN,name:"Player 1",style:P("lightblue"),grid:F,hideShips:!1}]])},$=new rt;$.on(N,s=>{console.log("State changed to",f[s])});const ot=new J(F,$);function lt(s,t,e){const r=document.getElementById(s);r.textContent="",r.textContent=e.render(t.hideShips)}function at(s,t,e,r=p.printGridInConsole){const{gridId:i}=t,n=t.players.get(s);if(lt(i,n,e),!r)return;const{name:o,style:a,hideShips:c}=n;console.log(`%c${o}`,a),console.log(`%c${e.render(c)}
`,a)}function M(s,t,e){at(s,t,e)}function P(s){return`color: ${s}; background-color: black; font-size: 20px; font-weight: bold;`}function ct(s){return`color: ${s};`}async function ht(s){return new Promise(t=>{const e=document.getElementById("playerInput"),r=document.getElementById("submitInput"),i=document.getElementById("inputResult");e.style.display="block",r.style.display="block",i.style.display="none",e.focus();const n=()=>{const a=e.value.trim();a!==""&&(i.textContent=`${s}: ${a}`,i.style.display="block",e.style.display="none",r.style.display="none",t(a),e.value="",e.removeEventListener("keydown",o))},o=a=>{a.key==="Enter"&&(a.preventDefault(),n())};r.onclick=n,e.addEventListener("keydown",o)})}async function dt(s,t,e){return new Promise(r=>{const i=document.getElementById("inputResult");i.textContent=`${s}: ${t} ${e?"hit":"miss"}`,i.style.display="block",r()})}function ut(s){return new Promise(t=>{const e=document.getElementById(s);if(!e)throw new Error(`Button with ID "${s}" not found`);e.style.display="block";const r=()=>{e.style.display="none",e.removeEventListener("click",i),document.removeEventListener("keydown",n),t()},i=()=>r(),n=o=>{o.key==="Enter"&&(o.preventDefault(),setTimeout(r,100))};e.addEventListener("click",i),setTimeout(()=>document.addEventListener("keydown",n),200)})}function mt(s,t){return[t,s]}async function ft(s,t){const{name:e}=s,{grid:r}=t;let i=!1,n={label:"",alreadyHit:!1,shipHit:!1,log:o=>""};for(;!i;){let o="";p.mode===S.PLAYER_VS_AI&&s.type===T.HUMAN?(o=await ht(e),n=r.hitCell(o),console.log(`${e}:`,o,n.shipHit?"hit":"miss")):s.type===T.AI&&(n=ot.aiMove(p.mode===S.PLAYER_VS_AI?{minLetter:"A",maxLetter:"J",minNumber:1,maxNumber:10}:E.range),console.log(n.log(n.shipHit)));const{alreadyHit:a}=n;a?console.log("%cThis cell was already hit. Try again.",ct("yellow")):(i=!0,await dt(s.name,n.label,n.shipHit))}}async function pt(){let s=!1,t=p.players.get(g.PLAYER1),e=p.players.get(g.PLAYER2);const r=new H(t.grid),i=new H(e.grid);for(;!s;){const n=t.role===g.PLAYER1?r:i;if(M(t.role,p,n),await ft(e,t),s=t.grid.isGameOver(),M(t.role,p,n),s){console.log("Game over! All ships have been sunk.");break}await ut("continueButton"),p.mode===S.PLAYER_VS_AI&&([e,t]=mt(e,t))}}await pt();
//# sourceMappingURL=index-CP-TYQWo.js.map
